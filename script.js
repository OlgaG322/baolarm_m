const phrases = {
    general: [
        "Конечно, ЭТОТ ролик точно будет\nпоследним. Как и предыдущие 47",
        "Да, давай досмотрим сезон.\nСон переоценен,\nа\nмешки под глазами — это модно",
        "«Высплюсь\nна\nвыходных» — план человека,\nкоторый не понимает,\nкак работает организм",
        "Ага, завтра точно ляжешь раньше.\nКак и позавчера обещал,\nи\nпозапозавчера...",
        "Ты экономишь время ночью,\nчтобы потратить его\nна\nзевоту днем. Эффективно!",
        "Зачем спать 8 часов,\nесли можно спать 4\nи\nчувствовать себя на все 100...\nпроцентов отвратительно",
        "Поздравляю! Ты снова доказал, что можешь превратить простую задачу\n«лечь спать»\nв\nквест на выживание",
        "Твоя способность находить «важные» дела\nв\n2 ночи достойна Нобелевки\nпо\nсамосаботажу",
        "Не сдавайся! У тебя получится наладить режим.\nМожет быть.\nКогда-нибудь.",
        "Тебе кажется, что ты обманываешь время.\nСпойлер:\nвремя побеждает",
        "Попробуй удивить меня — засни раньше полуночи.\nЯ уже 200 лет таких чудес не видел",
        "Попробуем сегодня лечь\nдо\nполуночи?\nЯ знаю, звучит безумно...",
        "Твой баобаб верит\nв\nтебя! Ну... почти верит.\nИногда.",
        "Браво! Ты мастерски превратил базовую потребность человека\nв\nолимпийский вид спорта\nпо\nсамоистязанию",
        "Твоя суперсила — делать\nиз\n8-часового сна 4-часовую пытку.\nВпечатляюще бесполезно!",
        "Твой мозг: «Хочу спать». Ты: «Нет,\nдавай листать мемы».\nПризрак логики плачет где-то\nв\nуглу",
        "Великолепно! Ты снова доказал, что можешь быть злейшим врагом самому себе\nбез\nвсяких усилий",
        "Твоя логика: «Завтра важный день,\nпоэтому лягу\nв\n3 ночи».\nПремию Дарвина\nв\nстудию!",
        "Поздравляю, ты превратил сон\nиз\nудовольствия\nв\nквест «найди 4 часа\nмежду\nпрокрастинацией\nи\nбудильником»",
        "Твоя кровать думает, что ты съехал\nс\nквартиры.\nМожет, пора познакомиться заново?",
        "Я выживаю\nв\nпустыне\nбез\nводы лучше,\nчем ты — без нормального сна",
        "Мои корни уходят глубже\nв\nземлю,\nчем твои отговорки —\nв\nреальность",
        "Ты живешь так,\nбудто у тебя запасная жизнь\nв\nшкафу\nна\nслучай,\nесли эту испортишь недосыпом",
        "Твоя стратегия «проживу\nна\nкофеине» работает примерно\nкак зонтик\nв\nторнадо",
        "Ты копишь усталость\nкак другие финансовую подушку.\nТак себе стратегия",
        "Ты живешь\nкак персонаж экшена — будто каждая ночь может стать последней,\nпоэтому спать нельзя",
        "Ты поступаешь\nс\nрежимом сна\nкак камикадзе — красиво,\nно\nс\nпредсказуемым финалом",
        "Ты относишься\nк\nсвоему здоровью\nкак\nк\nбесконечному ресурсу\nв\nвидеоигре.\nНовость:\nчиты не работают",
        "Твоя жизненная философия: «Зачем спать сегодня,\nесли можно страдать завтра?»",
        "Похоже,\nтвоя жизненная миссия — превратить каждое утро\nв\nэкзистенциальный кризис.\nУдачного недосыпа!",
        "Ты коллекционируешь бессонные ночи\nкак философ — ищешь смысл там,\nгде его нет",
        "Твоя стратегия выживания: «Сон для слабых,\nкофе — для сильных».\nКрепкая позиция... до первого нервного срыва",
        "Только\nв\nпараллельной реальности,\nгде время течет\nпо-другому,\n2 часа ночи равны «еще рано»",
        "Твоя душа вечна,\нa\nвот нервная система — нет",
        "Наблюдаю философский парадокс:\nты хочешь жить полной жизнью,\nно\nметодично сливаешь свою энергию",
        "Твое тело — храм.\nЖаль,\nчто ты его используешь\nкак дешевую круглосуточную забегаловку",
        "Ты живешь так,\nбудто планируешь стать совой\nв\nследующей жизни",
        "Анонс блокбастера «завтра начну жить правильно» слышен\nот\nтебя уже который год.\nКогда премьера?",
        "Твой режим сна — это перформанс\nв\nстиле дадаизма:\nбессмысленно,\nхаотично,\nно\nты называешь это искусством",
        "Ты создаешь авангардную инсталляцию\nпод\nназванием «Человек против подушки».\nЗрители\nв\nужасе",
        "Поздравляю! Ты мастер абстрактного экспрессионизма\nв\nобласти саморазрушения",
        "Твой график сна — чистый кубизм:\nвсё разломано\nна\nчасти\nи\nсобрано неправильно",
        "Ты практикуешь минимализм\nв\nсне\nи\nмаксимализм\nв\nпрокрастинации.\nПротиворечивая концепция",
        "И снова утро\nв\nстиле импрессионистов:\nразмытые контуры,\nнеясные очертания,\nвсё\nв\nтумане",
        "Провокационная композиция «Мой режим дня» — \nсаморазрушение\nчерез\nнедосып.\nКритики\nв\nрастерянности",
        "Твоя концептуальная инсталляция «Зомби\nна\nработе» получает премию\nза\nреализм",
        "Перед вами автопортрет\nв\nсостоянии хронического недосыпа.\nМасло,\nкофе,\нотчаяние",
        "Серия работ «Недоспанные будни» — исследование границ человеческой глупости",
        "Инсталляция «Кровать\nкак декорация» — ироничная работа\nо\nпредметах,\нпотерявших свое назначение",
        "Ты создал неоклассическую трагедию\nв\nтрех актах: «Не хочу спать», «Хочу спать», «Поздно спать»",
        "Ты практикуешь конструктивизм наоборот:\nразрушаешь структуру сна\nдля\nсоздания хаоса"
    ],
    bad: [
        "Доброе утро, зомби! Как спалось?",
        "Удивительно, как ты каждый день удивляешься, что устал",
        "Кофе не поможет. Но можешь попробовать — мне весело смотреть",
        "Посмотри на себя — ты почти справился! Всего-то проспал 3 будильника",
        "Сегодня ты достоин кисти абстракциониста: никто не понимает, что это должно означать"
    ],
    good: [
        "Ого! Целых 8 часов сна? Ты случайно не перепутал себя с нормальным человеком?",
        "Невероятно! Твои глаза не похожи на два кратера от метеоритов. Чудеса случаются!",
        "Ты выглядишь почти как человек, который выспался. Почти.",
        "Поздравляю! Ты снова доказал, что можешь спать как нормальный человек. Почти.",
        "Ты сегодня выглядишь почти как человек, а не как зомби. Почти."
    ]
};

const timePhrases = [
    "В это время\nя притворюсь, что ложусь спать",
    "Мой план: уснуть хотя бы к этому часу",
    "Мечтаю заснуть к этому времени",
    "Я обещаю себе лечь спать\nв это время (ха-ха)",
    "Поставить несбыточный дедлайн для сна",
    "Моя очередная попытка лечь пораньше",
    "Буду в кровати... ну, типа",
    "Я укажу время, а организм\nвсё равно проигнорирует",
    "Планирую заснуть к этому времени\n(но это не точно)",
    "В это время обещаю себе считать овец",
    "Попробую удивить себя и\nлечь спать вовремя",
    "Установить время для вечерних самообманов",
    "Поставить время, когда я должен был бы спать",
    "Установить время для очередного провала сна"
];

let sleepStart = null;
let alarmTime = null;

// Элементы
const setAlarmBtn = document.getElementById('setAlarm');
const alarmPhrase = document.getElementById('alarmPhrase');
const timePopup = document.getElementById('timePopup');
const popupHours = document.getElementById('popupHours');
const popupMinutes = document.getElementById('popupMinutes');
const popupOkBtn = document.getElementById('popupOkBtn');
const commentDiv = document.getElementById('comment');
const wakeBtn = document.getElementById('wakeBtn');
const sleepBtn = document.getElementById('sleepBtn');
const sleepStatus = document.getElementById('sleepStatus');

// Вспомогательные функции
function getRandomPhrase(type) {
    return phrases[type][Math.floor(Math.random() * phrases[type].length)];
}
function getRandomTimePhrase() {
    return timePhrases[Math.floor(Math.random() * timePhrases.length)];
}

// Заполнение селекторов времени
function fillTimeSelects() {
    popupHours.innerHTML = '';
    popupMinutes.innerHTML = '';
    for (let h = 0; h < 24; h++) {
        const opt = document.createElement('option');
        opt.value = h;
        opt.textContent = h.toString().padStart(2, '0');
        popupHours.appendChild(opt);
    }
    for (let m = 0; m < 60; m += 5) {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m.toString().padStart(2, '0');
        popupMinutes.appendChild(opt);
    }
}
fillTimeSelects();

// Обработчики
setAlarmBtn.addEventListener('click', () => {
    timePopup.style.display = 'flex';
});

popupOkBtn.addEventListener('click', () => {
    const hours = popupHours.value.padStart(2, '0');
    const minutes = popupMinutes.value.padStart(2, '0');
    alarmTime = `${hours}:${minutes}`;
    timePopup.style.display = 'none';
    alarmPhrase.innerHTML = getRandomTimePhrase().replace(/\n/g, "<br>");
});

window.addEventListener('click', (event) => {
    if (event.target === timePopup) {
        timePopup.style.display = 'none';
    }
});

sleepBtn.addEventListener('click', () => {
    sleepStart = new Date();
    sleepStatus.textContent = 'Сплю';
    alarmPhrase.textContent = `Дедлайн: ${alarmTime || '--:--'}`;
    commentDiv.textContent = getRandomPhrase('general');
});

wakeBtn.addEventListener('click', () => {
    if (!sleepStart) return;
    const sleepDurationMs = new Date() - sleepStart;
    const sleepDurationHours = sleepDurationMs / 3600000;
    sleepStatus.textContent = 'Не сплю';
    sleepStart = null;
    alarmPhrase.innerHTML = getRandomTimePhrase().replace(/\n/g, "<br>");
});

// Часы
function updateClock() {
    const now = new Date();
    document.getElementById('currentTime').textContent =
        now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
    setTimeout(updateClock, 1000);
}

// Инициализация
function initApp() {
    updateClock();
    commentDiv.textContent = getRandomPhrase('general');
    alarmPhrase.innerHTML = getRandomTimePhrase().replace(/\n/g, "<br>");
}

document.addEventListener('DOMContentLoaded', initApp);

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
}
